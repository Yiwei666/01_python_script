# 1. 项目功能



# 2. 文件结构

```
01_删除当前目录下无后缀ISAACS导出文件中的表头行.py
02_基于ISAACS配位原子数百分比提取.py
03_B-O配位数同时为3和4的聚合度分析.py
04_含Al掺杂的B最近邻和次近邻聚合度分析.py
05_将空格分隔的列数据保存到excel文件.py
06_将团簇分子式及占比txt数据转为xlsx文件格式.py
07_基于桥氧和总氧数提取多个txt文本中的指定大类团簇中各小类团簇百分比.py
```



# 3. 环境配置

### 1. `01_删除当前目录下无后缀ISAACS导出文件中的表头行.py`

1. 功能概述：

该代码的目的是在当前目录下查找没有文件后缀的文件，读取这些文件的内容，并删除文件中以 `@` 开头的行，然后将处理后的内容保存到一个新文件中。新文件的命名格式为原文件名加上 `origin_` 前缀。

2. 主要步骤：
    - 文件筛选：使用 `os.listdir('.')` 获取当前目录下的所有文件，筛选出没有文件后缀的文件。
    - 处理文件内容：对于每一个没有文件后缀的文件，打开文件并逐行读取。如果某一行不是以 `@` 开头，则将该行写入一个新文件。
    - 新文件保存：新文件的命名是将原文件的名称加上前缀 `origin_`，并将处理后的内容保存到该新文件中。

通过该方式获取到的数据文件可以：1. 复制粘贴到origin中绘图，2. 使用python脚本快速绘图获取截断半径，用于ISAACS后续的`bond properties`分析。


### 2. `02_基于ISAACS配位原子数百分比提取.py`

1. 待处理的数据示例（通常由ISAACS分析xyz轨迹文件得出）：

`example_rawdata.txt`

```
#Environments for Pt atoms:

#N(tot)   N(O )   N(Si)   N(Ca)   N(Pt)          Number   or     Percent
  4        4       0       0       0           5.50993   or      68.874 %
  5        5       0       0       0           0.77483   or       9.685 %
  3        3       0       0       0           1.29139   or      16.142 %
  2        2       0       0       0           0.42384   or       5.298 %
```

2. 功能：
    - 列出当前目录下的所有文件。
    - 读取用户指定的文件，跳过前三行，并提取第一列和倒数第二列的数据。
    - 将数据按第一列排序后输出。通常适用于最近邻配位结构，且配位原子仅有一种，特别是硅酸盐渣中 X-O 的配位结构统计分析。



### 3. `03_B-O配位数同时为3和4的聚合度分析.py`

1. 总体思路

```
请按照以下要求编写python代码，给出完整代码

读取脚本所在目录下的 B_isaacs.txt 数据文件，忽略前3行，其余数据（定义为数据集a0）分为若干列， 列和列之间使用空格分隔，进行如下计算：
打印出a0数据集
计算a0数据集第6列数据的和t1和第8列数据的和t2（浮点数计算），打印出来
从a0数据集中提取第5列数值为3的行（定义为a1数据集），分别计算这些行第6列数据的和x1和第8列数据的和x2（浮点数计算），打印出来；
从a0数据集中提取第5列数值为4的行（定义为b1数据集），分别计算这些行第6列数据的和y1和第8列数据的和y2（浮点数计算），打印出来；
然后分别计算a1数据集中每一行第2列和第3列数的加和az1，再选取其中 az1 小于等于3的行（定义为数据集a2），打印出来；
然后分别计算b1数据集中每一行第2列和第3列数的加和bz1，再选取其中 bz1 小于等于4的行（定义为数据集b2），打印出来；
然后分别计算数据集a2第6列数据的和x3和第8列数据的和x4（浮点数计算），打印出来，再计算并打印x1-x3和x2-x4的值；
然后分别计算数据集b2第6列数据的和y3和第8列数据的和y4（浮点数计算），打印出来，再计算并打印y1-y3和y2-y4的值；
定义k0=(x3+y3)/t1，打印出k0，打印出x3+y3，打印出x4+y4；
定义k1=x3/(x3+y3)，k2=y3/(x3+y3)，打印出 k1和k2；
再从数据集a2中选取第2列和第3列数的加和az1分别为0，1，2，3的行，分别标记为ac0，ac1，ac2，ac3数据集，分别计算这些数据集中第6列数据的和as0，as1，as2，as3，打印出这些和。计算并打印出 as0+as1+as2+as3的和；
再从数据集b2中选取第2列和第3列数的加和bz1分别为0，1，2，3，4的行，分别标记为bc0，bc1，bc2，bc3，bc4数据集，分别计算这些数据集中第6列数据的和bs0，bs1，bs2，bs3，bs4，打印出这些和。计算并打印出 bs0+bs1+bs2+bs3+bs4 的和。
分别打印出ac0，ac1，ac2，ac3数据集和bc0，bc1，bc2，bc3，bc4数据集。
然后计算并打印as0/x3*100%，as1/x3*100%，as2/x3*100%，as3/x3*100%的值，小数点后保留2位有效数字。计算并打印出这几个百分比的求和。
然后计算并打印bs0/y3*100%，bs1/y3*100%，bs2/y3*100%，bs3/y3*100%，bs4/y3*100%的值，小数点后保留2位有效数字。计算并打印出这几个百分比的求和。
然后计算并打印as0/(x3+y3)*100%，as1/(x3+y3)*100%，as2/(x3+y3)*100%，as3/(x3+y3)*100%的值，小数点后保留2位有效数字。计算并打印出这几个百分比的求和。
然后计算并打印bs0/(x3+y3)*100%，bs1/(x3+y3)*100%，bs2/(x3+y3)*100%，bs3/(x3+y3)*100%，bs4/(x3+y3)*100%的值，小数点后保留2位有效数字。计算并打印出这几个百分比的求和。
将a2和b2数据集中每一行第6列数据替换成原数据/k0，第8列数据替换成原数据/k0，小数点后保留3位有效数字，得到的新数据集分别定义为a3和b3。分别打印出数据集a3和b3。
然后分别计算数据集a3第6列数据的和x5和第8列数据的和x6（浮点数计算），打印出来。
然后分别计算数据集b3第6列数据的和y5和第8列数据的和y6（浮点数计算），打印出来。

注意：
x6=k1*100%
y6=k2*100%
x3=as0+as1+as2+as3
y3=bs0+bs1+bs2+bs3+bs4
```

2. 待处理的数据示例（通常由ISAACS分析xyz轨迹文件得出）：

`B_isaacs.txt`

```
Environments for B  atoms:

N(tot)   N(Si)   N(B )   N(Ca)   N(O )          Number   or     Percent
  8        4       0       0       4          35.05000   or      19.691 %
  8        3       1       0       4           2.05000   or       1.152 %
  7        4       0       0       3           5.20000   or       2.921 %
  6        3       0       0       3          29.71000   or      16.691 %
  5        1       1       0       3           1.24000   or       0.697 %
  6        2       1       0       3           1.37000   or       0.770 %
  7        3       0       0       4          32.26000   or      18.124 %
  4        1       0       0       3          17.99000   or      10.107 %
  5        2       0       0       3          34.32000   or      19.281 %
  6        2       0       0       4          10.24000   or       5.753 %
  3        0       0       0       3           1.75000   or       0.983 %
  7        2       1       0       4           1.75000   or       0.983 %
  6        1       1       0       4           0.27000   or       0.152 %
  9        5       0       0       4           0.91000   or       0.511 %
  5        1       0       0       4           2.09000   or       1.174 %
  7        3       1       0       3           0.57000   or       0.320 %
  8        5       0       0       3           0.40000   or       0.225 %
  9        4       1       0       4           0.04000   or       0.022 %
  4        0       1       0       3           0.34000   or       0.191 %
  8        2       2       0       4           0.21000   or       0.118 %
  4        0       0       0       4           0.07000   or       0.039 %
  5        0       1       0       4           0.02000   or       0.011 %
  8        4       1       0       3           0.03000   or       0.017 %
  7        1       2       0       4           0.05000   or       0.028 %
  6        1       2       0       3           0.02000   or       0.011 %
  5        0       2       0       3           0.02000   or       0.011 %
  6        0       2       0       4           0.01000   or       0.006 %
 10        6       0       0       4           0.01000   or       0.006 %
  7        2       2       0       3           0.01000   or       0.006 %
```


### 4. `04_含Al掺杂的B最近邻和次近邻聚合度分析.py`

1. 总体思路

```
请按照以下要求编写python代码，给出完整代码
赋值 col6 = 6，col8 = 8，col5 = 5，colist=[2, 3]
读取脚本所在目录下的 B_isaacs.txt 数据文件，忽略前3行，其余数据（定义为数据集a0）分为若干列， 列和列之间使用空格分隔，进行如下计算：
打印出a0数据集
计算a0数据集第col6列数据的和t1和第col8列数据的和t2（浮点数计算），打印出来
从a0数据集中提取第col5列数值为3的行（定义为a1数据集），分别计算这些行第col6列数据的和x1和第col8列数据的和x2（浮点数计算），打印出来；
从a0数据集中提取第col5列数值为4的行（定义为b1数据集），分别计算这些行第col6列数据的和y1和第col8列数据的和y2（浮点数计算），打印出来；
然后分别计算a1数据集中每一行指定列(数组colist中列出的所有列)数的加和az1，再选取其中 az1 小于等于3的行（定义为数据集a2），打印出来；
然后分别计算b1数据集中每一行指定列(数组colist中列出的所有列)数的加和bz1，再选取其中 bz1 小于等于4的行（定义为数据集b2），打印出来；
然后分别计算数据集a2第col6列数据的和x3和第col8列数据的和x4（浮点数计算），打印出来，再计算并打印x1-x3和x2-x4的值；
然后分别计算数据集b2第col6列数据的和y3和第col8列数据的和y4（浮点数计算），打印出来，再计算并打印y1-y3和y2-y4的值；
定义k0=(x3+y3)/t1，打印出k0，打印出x3+y3，打印出x4+y4；
定义k1=x3/(x3+y3)，k2=y3/(x3+y3)，打印出 k1和k2；
再从数据集a2中选取指定列(数组colist中列出的所有列)数的加和az1分别为0，1，2，3的行，分别标记为ac0，ac1，ac2，ac3数据集，分别计算这些数据集中第col6列数据的和as0，as1，as2，as3，打印出这些和。计算并打印出 as0+as1+as2+as3的和；
再从数据集b2中选取指定列(数组colist中列出的所有列)数的加和bz1分别为0，1，2，3，4的行，分别标记为bc0，bc1，bc2，bc3，bc4数据集，分别计算这些数据集中第col6列数据的和bs0，bs1，bs2，bs3，bs4，打印出这些和。计算并打印出 bs0+bs1+bs2+bs3+bs4的和。
分别打印出ac0，ac1，ac2，ac3数据集和bc0，bc1，bc2，bc3，bc4数据集。
然后计算并打印as0/x3*100%，as1/x3*100%，as2/x3*100%，as3/x3*100%的值，小数点后保留2位有效数字。计算并打印出这几个百分比的求和。
然后计算并打印bs0/y3*100%，bs1/y3*100%，bs2/y3*100%，bs3/y3*100%，bs4/y3*100%的值，小数点后保留2位有效数字。计算并打印出这几个百分比的求和。
然后计算并打印as0/(x3+y3)*100%，as1/(x3+y3)*100%，as2/(x3+y3)*100%，as3/(x3+y3)*100%的值，小数点后保留2位有效数字。计算并打印出这几个百分比的求和。
然后计算并打印bs0/(x3+y3)*100%，bs1/(x3+y3)*100%，bs2/(x3+y3)*100%，bs3/(x3+y3)*100%，bs4/(x3+y3)*100%的值，小数点后保留2位有效数字。计算并打印出这几个百分比的求和。
将a2和b2数据集中每一行第col6列数据替换成原数据/k0，第col8列数据替换成原数据/k0，小数点后保留3位有效数字，得到的新数据集分别定义为a3和b3。分别打印出数据集a3和b3，。
然后分别计算数据集a3第col6列数据的和x5和第col8列数据的和x6（浮点数计算），打印出来。
然后分别计算数据集b3第col6列数据的和y5和第col8列数据的和y6（浮点数计算），打印出来。
```

2. 体系中不含Al体系（CaO-SiO2-B2O3）

```
Environments for B  atoms:

N(tot)   N(Si)   N(B )   N(Ca)   N(O )          Number   or     Percent
  8        4       0       0       4          35.05000   or      19.691 %
  8        3       1       0       4           2.05000   or       1.152 %
  7        4       0       0       3           5.20000   or       2.921 %
  6        3       0       0       3          29.71000   or      16.691 %
```

- 环境变量

```py
# 定义cluster字典，键为元素符号，值为对应的列数（列数等于列的索引+1）
cluster = {"Si": 2, "B": 3, "O": 5}

# 定义变量，将列数转换为索引
# Number，B原子数所在列，该列求和为体系所有B原子数
col6 = 6 - 1                
# Percent，百分比所在列
col8 = 8 - 1
# N(O )，O原子配位数所在列
col5 = 5 - 1
# N(Si)   N(B ) 等所在列，修改列表 [2, 3]
colist = [c - 1 for c in [2, 3]]  # 列数转为索引
```

需要修改的环境变量包括 `Number Percent O` 以及 `Si B` 所在的列数

3. 体系中含Al体系（CaO-SiO2-Al2O3-B2O3）

```
Environments for B  atoms:

N(tot)   N(Si)   N(Al)   N(B )   N(Ca)   N(O )          Number   or     Percent
  6        3       0       0       0       3           8.88000   or       9.867 %
  6        0       1       1       0       4           0.01000   or       0.011 %
  5        2       0       0       0       3          14.99000   or      16.656 %
  7        3       0       0       0       4          10.28000   or      11.422 %
  8        4       0       0       0       4          10.60000   or      11.778 %
```

- 环境变量

```py
# 定义cluster字典，键为元素符号，值为对应的列数（列数等于列的索引+1）
cluster = {"Si": 2, "Al": 3, "B": 4, "O": 6}

# 定义变量，将列数转换为索引
# Number，B原子数所在列，该列求和为体系所有B原子数
col6 = 7 - 1                
# Percent，百分比所在列
col8 = 9 - 1
# N(O )，O原子配位数所在列
col5 = 6 - 1
# N(Si)   N(B ) 等所在列，修改列表 [2, 3]
colist = [c - 1 for c in [2, 3, 4]]  # 列数转为索引
```

需要修改的环境变量包括 `Number, Percent, O` 以及 `Si, Al, B` 所在的列数


### 5. `05_将空格分隔的列数据保存到excel文件.py`

- 功能：读取脚本所在目录下的 `B_isaacs.txt` 数据文件，忽略前三行，剩下的数据包含若干列，列和列之间使用空格分隔，将剩余数据写入到 `B_isaacs.xlsx` 数据文件中，使得txt文件中的每列数据在xlsx文件中也为1列。

```py
import pandas as pd

# 读取B_isaacs.txt文件，跳过前3行，并指定空格作为分隔符
df = pd.read_csv('B_isaacs.txt', sep='\s+', skiprows=3, header=None)

# 将数据写入B_isaacs.xlsx文件
df.to_excel('B_isaacs.xlsx', index=False, header=False)

print("数据已成功写入B_isaacs.xlsx文件。")
```


### 6. `06_将团簇分子式及占比txt数据转为xlsx文件格式.py`

- 功能：打印脚本所在目录下的所有文件名，提示用户输入文件名。逐行读取文件，逐行判断，如果该行含有`%`，则保留该行数据，每一行的多列之间使用空格分隔，最后将所有含有%的行写入到 `xlsx` 文件中，仍然使用原文件名。

txt格式的数据文件：`团簇百分比及分子式.txt`

```
a3 data (sorted by az1 ascending and col8 descending with cluster_combo):
    0  1  2  3  4  5       6   7       8  9  az1 cluster_combo
52  3  0  0  0  0  3   0.752  or   0.427  %    0            O3
81  6  0  2  1  0  3   0.424  or   0.241  %    3       Al2B1O3
63  6  1  0  2  0  3   0.133  or   0.076  %    3       Si1B2O3
b3 data (sorted by bz1 ascending and col8 descending with cluster_combo):
    0  1  2  3  4  5       6   7      8  9  bz1 cluster_combo
92  4  0  0  0  0  4   0.024  or  0.013  %    0            O4
42  8  3  0  1  0  4   1.067  or  0.606  %    4       Si3B1O4
50  8  0  4  0  0  4   0.824  or  0.468  %    4         Al4O4
86  8  1  1  2  0  4   0.024  or  0.013  %    4    Si1Al1B2O4
x5: 94.88400000000001, x6: 53.914
y5: 81.113, y6: 46.083
```

注意：生成的xlsx文件中，默认各列数据都是文本格式，excel可以直接转为数据格式。在排序过程中2，注意包含第一列数据，避免其不参与排序的问题。

<p align="center">
<img src="https://19640810.xyz/05_image/01_imageHost/20241029-091144.png" alt="Image Description" width="900">
</p>


### 7. `07_基于桥氧和总氧数提取多个txt文本中的指定大类团簇中各小类团簇百分比.py`

- 使用python编写脚本实现以下功能。
   - 脚本所在目录下有好几个txt数据文本，这些文本中含有好多行，每行含有多列，列和列之间使用空格分隔，只读取含有%的行，把每个文本中的这部分数据命名为data。data每行列数一定是相同的，如果不相同，给出提示，并结束程序运行，后续运算都是基于data数据。
   - 请依次读取这些data数据，首先为每个data数据构建一个字典，字典的键是data每行的最后一列（已确定data最后一列不会重复，如果重复请提示并结束），每个键的值是一个列表list，列表的元素依次是该行的倒数第7列值（list[0]），倒数第2列值（list[1]）和倒数第4列值（list[2]）。
   - 提示用户依次输入两个整数BO和TO，现在查找每个字典中同时满足 `list[0]=TO` 和 `list[1]=BO` 的键，并记录该键对应的 `list[2]`。
   - 最后请按照如下表格格式打印结果，并将结果以表格形式保存到xlsx文件中，命名为 `TO-BO.xlsx`。注意满足要求的部分键可能在一部分文本中存在，另外一部分文本中没有，没有时可以使用0作为替代。
   - 注意，如果某个键对应的行值全为0，则该行不需要打印，也不需要写入到xlsx文件中；在写入的excel文件中，能不能再重复写入一组转置后的的数据，即文本行作为列，键列作为行

- 新增功能：将键值中的元素符号和对应数字转换为指定格式，以便用于origin绘图。
   - 在转置后的数据表格中再新增一行，该行首先复制 键 对应的行，该行含有多个键，每个键都是由元素符号和数字组成，例如 键`"Si1Al1B2O4"`是由 `Si1 Al1 B2 O4`，这4部分构成，现在需要根据一定的规则将这个键转化成另外一种形式。
   - 注意每个键中，最多含有四种元素符号，分别是 `Si，Al，B，O`， 每个元素后紧邻的对应数字分别为`a，b，c，d`；最少含有一种元素符号。 
   - 首先计算，`x= d-a-b-c`，将键中原有的Si替换成`(SiO\-(4))`，将 Al 替换成 `(AlO\-(4))`，将B替换成 `(BO\-(3))`。注意新组成的键的格式为 `"B"+"O\-(x)"+"(BO\-(3))\-(c)"+"(AlO\-(4))\-(b)"+"(SiO\-(4))\-(a)"`。如果 `a，b，c，x` 中有值为0，则包含该值的 `" "` 相应部分要删除，例如b=0，则 `"(AlO\-(4))\-(b)"` 部分删除掉，若x=0，`"O\-(x)"`删掉，以此类推；
   - 如果 `a，b，c，x` 中有值为1，只需要将对应的`"\-()"`部分删除掉即可，例如 c=1，则 `"(BO\-(3))\-(c)"` 部分变成 `"(BO\-(3))"，b=1，"(AlO\-(4))\-(b)"`变成`(AlO\-(4))"`，对于 `a，b，c，x` 取非0和非1值，则按照   `"B"+"O\-(x)"+"(BO\-(3))\-(c)"+"(AlO\-(4))\-   - (b)"+"(SiO\-(4))\-(a)"` 格式的字符串拼接输出。

```
        文本1       文本2      文本3       文本4      ...
键1  list[2]       list[2]     list[2]        list[2]      ...
键2    ...
键3    ...
键4
...
```













