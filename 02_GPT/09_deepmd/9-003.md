# deepmd-kit官方入门案例

# 1. 数据准备

1. 数据下载

官方下载链接：https://dp-public.oss-cn-beijing.aliyuncs.com/community/CH4.tar

浏览器中可直接下载，windows直接解压缩


2. 数据目录

```
├── CH4
    ├── 00.data
        └── OUTCAR
    ├── 01.train
        └── input.json
    └── 02.lmp
        ├── conf.lmp
        └── in.lammps
```

OUTCAR：vasp详细的计算日志，记录所有计算过程中的关键信息（如能量、力、应力、原子位置、电子自洽迭代等）。是分析计算结果的主要文件。


3. 提取训练数据和测试数据

```py
import dpdata  # 导入dpdata模块，用于处理材料计算数据
import numpy as np  # 导入NumPy库，用于数值计算

# 读取VASP输出文件'OUTCAR'，并以'vasp/outcar'格式解析，生成一个包含多个帧的系统数据
data = dpdata.LabeledSystem('OUTCAR', fmt='vasp/outcar')  

# 打印数据中包含的帧数
print('# the data contains %d frames' % len(data))  

# 从前200帧中随机选择40帧作为验证集，确保不重复选择
index_validation = np.random.choice(200, size=40, replace=False)

# 将剩余帧（即不在验证集中的帧）作为训练集的索引
index_training = list(set(range(200)) - set(index_validation))

# 从原始数据中提取训练集子系统，包含index_training指定的帧
data_training = data.sub_system(index_training)

# 从原始数据中提取验证集子系统，包含index_validation指定的帧
data_validation = data.sub_system(index_validation)

# 将训练数据保存为DeepMD格式的NumPy数组，目录为'training_data'
data_training.to_deepmd_npy('training_data')

# 将验证数据保存为DeepMD格式的NumPy数组，目录为'validation_data'
data_validation.to_deepmd_npy('validation_data')

# 打印训练数据中包含的帧数
print('# the training data contains %d frames' % len(data_training)) 

# 打印验证数据中包含的帧数
print('# the validation data contains %d frames' % len(data_validation))
```

从VASP输出文件中读取材料计算数据，并将前200帧随机分成40帧的验证集和160帧的训练集，随后将这两个数据集分别保存为DeepMD格式，并打印出各自包含的帧数。

- 运行上述代码后生成如下文件目录（新生成`training_data`和`validation_data` 文件夹）

```
├── 00.data
    ├── OUTCAR
    ├── training_data
        ├── set.000
        ├── type.raw
        └── type_map.raw
    └── validation_data
        ├── set.000
        ├── type.raw
        └── type_map.raw
```



# 2. 训练输入脚本

### 1. 示例脚本

- `input.json`

```json
{
    "_comment": " model parameters",
    "model": {
	"type_map":	["H", "C"],
	"descriptor" :{
	    "type":		"se_e2_a",
	    "sel":		[4, 1],
	    "rcut_smth":	0.50,
	    "rcut":		6.00,
	    "neuron":		[10, 20, 40],
	    "resnet_dt":	false,
	    "axis_neuron":	4,
	    "seed":		1,
	    "_comment":		" that's all"
	},
	"fitting_net" : {
	    "neuron":		[100, 100, 100],
	    "resnet_dt":	true,
	    "seed":		1,
	    "_comment":		" that's all"
	},
	"_comment":	" that's all"
    },

    "learning_rate" :{
	"type":		"exp",
	"decay_steps":	5000,
	"start_lr":	0.001,	
	"stop_lr":	3.51e-8,
	"_comment":	"that's all"
    },

    "loss" :{
	"type":		"ener",
	"start_pref_e":	0.02,
	"limit_pref_e":	1,
	"start_pref_f":	1000,
	"limit_pref_f":	1,
	"start_pref_v":	0,
	"limit_pref_v":	0,
	"_comment":	" that's all"
    },

    "training" : {
	"training_data": {
	    "systems":		["../00.data/training_data"],
	    "batch_size":	"auto",
	    "_comment":		"that's all"
	},
	"validation_data":{
	    "systems":		["../00.data/validation_data"],
	    "batch_size":	"auto",
	    "numb_btch":	1,
	    "_comment":		"that's all"
	},
	"numb_steps":	1000000,
	"seed":		10,
	"disp_file":	"lcurve.out",
	"disp_freq":	1000,
	"save_freq":	10000,
	"_comment":	"that's all"
    },    

    "_comment":		"that's all"
}
```




# 3. 模型训练



# 4. 冻结/压缩模型


# 5. 模型测试


# 6. lammps运行





# 参考资料

- [上机教程v2.0.3版本](https://tutorials.deepmodeling.com/zh-cn/latest/Tutorials/DeePMD-kit/learnDoc/Handson-Tutorial%28v2.0.3%29.html)
- [训练甲烷深度势能分子动力学模型v2.2.1版本](https://bohrium.dp.tech/notebooks/3313403083)
