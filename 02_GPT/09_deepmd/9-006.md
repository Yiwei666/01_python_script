# dp-gen输入文件和关键词

# 1. 概述

- `param.json` 文件作为 DP-GEN run 流程的核心配置文件，详细定义了用于指导系统和数据处理、模型训练、结构探索（模型偏差）以及第一性原理计算（标注）这四个关键步骤的各项参数和设置。



# 2. dp-gen 输入文件

## 1. 官方上手案例/甲烷/vasp


1. 文件下载地址

- https://dp-public.oss-cn-beijing.aliyuncs.com/community/dpgen_example.tar.xz


2. 项目文件夹

```
├── init
    ├── CH4.POSCAR
    ├── CH4.POSCAR.01x01x01
        ├── 00.place_ele
        ├── 01.scale_pert
        ├── 02.md
        └── param.json
    ├── INCAR_methane.md
    ├── INCAR_methane.rlx
    └── param.json
└── run
    ├── INCAR_methane
    ├── POTCAR_C
    ├── POTCAR_H
    ├── machine.json
    └── param.json
```

- 文件夹 `init` 包含由 AIMD 模拟生成的初始数据。
  - 文件夹 `CH4.POSCAR.01x01x01` 包含由 DP-GEN `init_bulk` 过程生成的文件。
  - `INCAR_*` 和 `CH4.POSCAR` 是 VASP 的标准 INCAR 和 POSCAR 文件。
  - `param.json` 用于指定 DP-GEN `init_bulk` 过程的详细设置。

- 文件夹 `run` 包含运行过程的输入文件。
  - `param.json` 是当前任务中 DP-GEN 的设置文件。
  - `machine.json` 是一个任务分配器，用于设置机器环境和资源需求。
  - `INCAR*` 和 `POTCAR*` 是 VASP 软件包的输入文件，所有第一性原理计算共享与 `param.json` 中设置的相同参数。



### 1. `param.json`文件

```json
{
     "type_map": ["H","C"],
     "mass_map": [1,12],
     "init_data_prefix": "../",
     "init_data_sys": ["init/CH4.POSCAR.01x01x01/02.md/sys-0004-0001/deepmd"],
     "sys_configs_prefix": "../",
     "sys_configs": [
         ["init/CH4.POSCAR.01x01x01/01.scale_pert/sys-0004-0001/scale-1.000/00000*/POSCAR"],
         ["init/CH4.POSCAR.01x01x01/01.scale_pert/sys-0004-0001/scale-1.000/00001*/POSCAR"]
     ],
     "_comment": " that's all ",
     "numb_models": 4,
     "default_training_param": {
         "model": {
             "type_map": ["H","C"],
             "descriptor": {
                 "type": "se_a",
                 "sel": [16,4],
                 "rcut_smth": 0.5,
                 "rcut": 5.0,
                 "neuron": [120,120,120],
                 "resnet_dt": true,
                 "axis_neuron": 12,
                 "seed": 1
             },
             "fitting_net": {
                 "neuron": [25,50,100],
                 "resnet_dt": false,
                 "seed": 1
             }
         },
         "learning_rate": {
             "type": "exp",
             "start_lr": 0.001,
             "decay_steps": 5000
         },
         "loss": {
             "start_pref_e": 0.02,
             "limit_pref_e": 2,
             "start_pref_f": 1000,
             "limit_pref_f": 1,
             "start_pref_v": 0.0,
             "limit_pref_v": 0.0
         },
         "training": {
             "stop_batch": 2000,
             "disp_file": "lcurve.out",
             "disp_freq": 1000,
             "numb_test": 4,
             "save_freq": 1000,
             "save_ckpt": "model.ckpt",
             "disp_training": true,
             "time_training": true,
             "profiling": false,
             "profiling_file": "timeline.json",
             "_comment": "that's all"
         }
     },
     "model_devi_dt": 0.002,
     "model_devi_skip": 0,
     "model_devi_f_trust_lo": 0.05,
     "model_devi_f_trust_hi": 0.15,
     "model_devi_e_trust_lo": 10000000000.0,
     "model_devi_e_trust_hi": 10000000000.0,
     "model_devi_clean_traj": true,
     "model_devi_jobs": [
         {"sys_idx": [0],"temps": [100],"press": [1.0],"trj_freq": 10,"nsteps": 300,"ensemble": "nvt","_idx": "00"},
         {"sys_idx": [1],"temps": [100],"press": [1.0],"trj_freq": 10,"nsteps": 3000,"ensemble": "nvt","_idx": "01"}
     ],
     "fp_style": "vasp",
     "shuffle_poscar": false,
     "fp_task_max": 20,
     "fp_task_min": 5,
     "fp_pp_path": "./",
     "fp_pp_files": ["POTCAR_H","POTCAR_C"],
     "fp_incar": "./INCAR_methane"
}
```




### 2. `machine.json`文件

```json
{
	"api_version": "1.0",
	"deepmd_version": "2.0.1",
	"train" :[
		{
			"command": "dp",
			"machine": {
				"batch_type": "Shell",
				"context_type": "local",
				"local_root" : "./",
				"remote_root": "/home/ecust/lws"
			},
			"resources": {
				"number_node": 1,
				"cpu_per_node": 4,
				"gpu_per_node": 1,
				"group_size": 1
			}
		}
	],
	"model_devi":[
		{
			"command": "mpirun -n 4 lmpdplws -i input.lammps",
			"machine": {
				"batch_type": "Shell",
				"context_type": "local",
				"local_root" : "./",
				"remote_root": "/home/ecust/lws"
			},
			"resources": {
				"number_node": 1,
				"cpu_per_node": 4,
				"gpu_per_node": 1,
				"group_size": 5
			}
		}
	],
	"fp":[
		{
			"command": "mpirun -n 4 vasplws",
			"machine": {
				"batch_type": "Shell",
				"context_type": "local",
				"local_root" : "./",
				"remote_root": "/home/ecust/lws"
			},
			"resources": {
				"number_node": 1,
				"cpu_per_node": 4,
				"gpu_per_node": 1,
				"group_size": 125
			}
		}
	]
}
```


# 3. 甲烷/vasp/github官方

- dp-gen官方github在 `dpgen/examples/run/` 中提供了不同 `param.json` 的示例。
- 本节以 `dpgen/examples/run/dp2.x-lammps-vasp/param_CH4_deepmd-kit-2.0.1.json` 为例，描述 `param.json` 的功能。
- 这是一个针对气相甲烷分子的 `param.json` 文件，其中使用 `DeePMD-kit（v2.x）` 进行训练，LAMMPS 进行探索，VASP 进行标记。

## 1. 输入文件

### 1. `param_CH4_deepmd-kit-2.0.1.json`文件

```json
{
    "type_map": [
        "H",
        "C"
    ],
    "mass_map": [
        1,
        12
    ],
    "init_data_prefix": "./",
    "init_data_sys": [
        "CH4.POSCAR.01x01x01/02.md/sys-0004-0001/deepmd"
    ],
    "sys_configs_prefix": "./",
    "sys_configs": [
        [
            "CH4.POSCAR.01x01x01/01.scale_pert/sys-0004-0001/scale*/00000*/POSCAR"
        ],
        [
            "CH4.POSCAR.01x01x01/01.scale_pert/sys-0004-0001/scale*/00001*/POSCAR"
        ]
    ],
    "_comment1": " that's all ",
    "numb_models": 4,
    "default_training_param": {
        "model": {
            "type_map": [
                "H",
                "C"
            ],
            "descriptor": {
                "type": "se_a",
                "sel": [
                    16,
                    4
                ],
                "rcut_smth": 0.5,
                "rcut": 5.0,
                "neuron": [
                    120,
                    120,
                    120
                ],
                "resnet_dt": true,
                "axis_neuron": 12,
                "seed": 1
            },
            "fitting_net": {
                "neuron": [
                    25,
                    50,
                    100
                ],
                "resnet_dt": false,
                "seed": 1
            }
        },
        "learning_rate": {
            "type": "exp",
            "start_lr": 0.001,
            "decay_steps": 100
        },
        "loss": {
            "start_pref_e": 0.02,
            "limit_pref_e": 2,
            "start_pref_f": 1000,
            "limit_pref_f": 1,
            "start_pref_v": 0.0,
            "limit_pref_v": 0.0
        },
        "training": {
            "numb_steps": 2000,
            "batch_size": 1,
            "disp_file": "lcurve.out",
            "disp_freq": 1000,
            "save_freq": 1000,
            "save_ckpt": "model.ckpt",
            "disp_training": true,
            "time_training": true,
            "profiling": false,
            "profiling_file": "timeline.json",
            "_comment2": "that's all"
        }
    },
    "model_devi_dt": 0.002,
    "model_devi_skip": 0,
    "model_devi_f_trust_lo": 0.05,
    "model_devi_f_trust_hi": 0.15,
    "model_devi_clean_traj": true,
    "model_devi_jobs": [
        {
            "sys_idx": [
                0
            ],
            "temps": [
                100
            ],
            "press": [
                1.0
            ],
            "trj_freq": 10,
            "nsteps": 300,
            "ensemble": "nvt",
            "_idx": "00"
        },
        {
            "sys_idx": [
                1
            ],
            "temps": [
                100
            ],
            "press": [
                1.0
            ],
            "trj_freq": 10,
            "nsteps": 3000,
            "ensemble": "nvt",
            "_idx": "01"
        }
    ],
    "fp_style": "vasp",
    "shuffle_poscar": false,
    "fp_task_max": 20,
    "fp_task_min": 5,
    "fp_pp_path": "./",
    "fp_pp_files": [
        "POTCAR_H",
        "POTCAR_C"
    ],
    "fp_incar": "./INCAR_methane"
}
```


## 2. 关键词概述

### 1. basics

- `type_map`：定义参与体系的原子种类，本例为 ["H", "C"]。
- `mass_map`：对应上面原子种类的原子量，本例为 [1, 12]。


### 2. data

- `init_data_prefix & init_data_sys`：指定初始训练数据所在目录及子目录，用于第一轮模型训练。
- `sys_configs_prefix & sys_configs`：指定用于“模型偏差评估”（model_devi）阶段的结构集所在目录及模式匹配路径，文中将体系分为两组、分别对应两个子路径。



### 3. training

- `numb_models`：每轮训练要并行生成的子模型数（即用不同随机种子训练的模型个数），本例为 4。
- `default_training_param`：传递给 DeePMD-kit 的训练超参数（例如学习率、网络层次等），在此处留空，实际使用时参照 DeePMD-kit 文档填充。

- `axis_neuron`：指定嵌入矩阵中用于轴方向（axis）的子矩阵大小。

  - 在 SE-A 描述子里，会把原子对之间的“径向”信息和“角度”信息分别映射到两个子网络：一个是常规的多层感知器处理径向（neuron 数组）；另一个就是“轴”网络，用来处理由中心—邻居向量构成的方向性（角度）信息，`axis_neuron` 就是后者每层的神经元数量。

  - 它决定了模型对角度特征的表达能力——节点越多，能捕捉越复杂的角度相关性，但计算量也更大。

  - 如何选取，基于系统复杂度与径向网络的配合：

    - 对于简单的小分子（如 CH₄），角度分布较规则，`axis_neuron=8∼16` 通常足够；

    - 对于多组分、配位环境多变的无序体系（如液相金属、复杂氧化物），可以考虑 `axis_neuron=16∼32`，以增强对各向异性环境的分辨率。

    - 如果径向网络每层节点数很大（如 `[120,120,120]`），则角度网络也可适当加大；

    - 若径向网络较小（如 `[64,64]`），角度网络设得太大反而容易过拟合。

    - 经验值：多数文献和示例里，`axis_neuron` 取在 8～24 的区间既能兼顾精度，又不会显著拖累性能；如果你不确定，从 12 或 16 开始调参，逐步试验收敛性与预测误差，就能找到最优值。


- `resnet_dt`：布尔选项，若为 true，则在 ResNet 结构中使用时间步长信息。

  - `resnet_dt` 这个参数控制的是在 DeepMD-kit 网络中“是否使用 ResNet（残差）结构”——也就是说，在每一层输出上加上一条`“跳跃连接”`（skip connection），以缓解梯度消失、加快收敛。

  - `resnet_dt`何时设为 `true`：网络比较深、层数和节点数都较大（如  `"neuron": [240, 240, 240]` ），需要残差跳跃来保证梯度流动和加速收敛；

  - `resnet_dt`何时设为 `false`：网络较浅、参数量适中，不会出现梯度难以传播的情况。网络更浅，节点数较少（如只有三层 `25→50→100`），不加残差结构也能轻松训练；

  - 如果你希望网络更“平滑”地拟合能量/力场，也可以保持 false；但假如你把拟合网络也加深到五层、十层，就可以考虑把它改为 true，引入残差，提升训练稳定性。


- `batch_size: 1`
  - 每次迭代训练时从数据集中抽取的样本数（batch size）。1 表示逐帧（single-sample）训练，梯度更新更频繁；若你有足够显存或希望加速，可增大到 4、8、16 等。

- `save_ckpt: "model.ckpt"`
  - 指定检查点文件（checkpoint）的前缀或路径模板。训练过程中，每到 save_freq 步就会把当前模型权重保存为 `model.ckpt-<step>.data-00000-of-00001、.index、.meta` 等一系列文件，以便中途重启或回滚。

- `disp_training: true`
  - 是否在控制台（或日志）实时打印训练过程中的损失、学习率等细节。设为 true 可让你边训练边监控收敛情况；若想纯后台运行且减少 IO，可设为 false。

- `time_training: true`
  - 是否记录并输出训练耗时信息。开启后，每若干步会打印本轮或累计耗时，用以评估性能瓶颈和优化并行配置；若你不关心速度，亦可关掉。

- `profiling: false`
  - 是否开启更细粒度的性能剖析（profiling），收集各操作（前向、反向、I/O 等）的时间分布；仅在你需要诊断训练速度瓶颈时设为 true，否则留作 false。

- `profiling_file: "timeline.json"`
  - 当 `profiling=true` 时，指定剖析结果输出的文件名。你可以用 TensorBoard 或 Chrome tracing 加载该 `timeline.json`，可视化每一步的运算成本、CUDA 吞吐等。


### 4. exploration

- `model_devi_dt`：MD 时间步长（单位 ps，本例 0.002）。
- `model_devi_skip`：跳过多少步不保存结构（本例 0）。
- `model_devi_f_trust_lo` 与 `model_devi_f_trust_hi`：力偏差筛选阈值下限（0.05 eV/Å）和上限（0.15 eV/Å）。
- `model_devi_clean_traj`：是否清理中间轨迹文件夹（默认 true）。
- `model_devi_jobs` 列表：针对不同结构组分别设置 MD 任务
  - `sys_idx`：引用 `sys_configs` 中的哪一组结构。
  - `temps, press`：温度（K）和压力（Bar）。
  - `trj_freq`：保存轨迹的频率（步数）。
  - `nsteps`：总运行步数。
  - `ensemble`：热力学系综（如 "nvt"）。
  - `_idx`：该作业的内部索引标签。



### 5. labeling

- `fp_style`：第一性原理计算软件，本例使用 "vasp"。
- `fp_task_min & fp_task_max`：每轮迭代中最少与最多要提交的构型数（1–20）。
- `fp_pp_path & fp_pp_files`：VASP 赝势文件目录和文件名（如 POTCAR）
- `fp_incar`：VASP 输入参数文件（INCAR），其中必须显式指定 KSPACING 与 KGAMMA 等关键项。








参考资料：
- https://github.com/deepmodeling/dpgen/tree/master/examples/run/dp2.x-lammps-vasp
- [Example-of-param.json](https://docs.deepmodeling.com/projects/dpgen/en/devel/run/example-of-param.html)




# 4. H2O体系/cp2k

- H2O体系，基于CP2K的DFT标注

### 1. `param.json`文件

```json
{
     "type_map": ["H"," O"],    # 初始数据集中所包含的元素，顺序与npy数据中的一样即可
     "mass_map": [1,16],        # 元素的相对原子质量
     "init_data_prefix": "../", # 初始数据集路径中的前缀
     "init_data_sys": ["00data/training_data/H2O1"  # 初始数据集路径除前缀后的部分。所以我的初始数据集路径为："../00data/training_data/H2O1"
],
     "sys_configs_prefix": "../",       # 用于动力学模拟的结构种子路径中的前缀
     "sys_configs": [
	["00data/initial_structure/1/*"]    # 用于动力学模拟的结构种子路径除前缀后的部分
     ],
     "_comment": " that's all ",
     "numb_models": 4,                  # 训练的DP势数量
     "default_training_param": {
         "model": {
             "type_map": ["H","O"],     # 体系元素种类
             "descriptor": {
                 "type": "se_e2_a",     
                 "sel": [200,100],      # 截断半径内可能包含的相应元素的原子数最大值
                 "rcut_smth": 0.5,      # 开始平滑处理的距离
                 "rcut":6.0,            # 截断半径
                 "neuron": [20,40,80],
                 "resnet_dt": false,
                 "axis_neuron": 12,
                 "seed": 1
             },
             "fitting_net": {
                 "neuron": [150,150,150],
                 "resnet_dt": true,
                 "seed": 1
             }
         },
         "learning_rate": {
             "type": "exp",
             "start_lr": 0.001,
	     "stop_lr":	3.51e-8,
             "decay_steps": 1000
         },
         "loss": {
             "start_pref_e": 0.02,
             "limit_pref_e": 2,
             "start_pref_f": 1000,
             "limit_pref_f": 1,
             "start_pref_v": 0.0,
             "limit_pref_v": 0.0
         },
         "training": {
             "stop_batch": 200000,
             "disp_file": "lcurve.out",
             "disp_freq": 1000,
             "numb_test": 4,
             "save_freq": 1000,
             "save_ckpt": "model.ckpt",
             "disp_training": true,
             "time_training": true,
             "profiling": false,
             "profiling_file": "timeline.json",
             "_comment": "that's all"
         }
     },
     "model_devi_dt": 0.0005,
     "model_devi_skip": 0,
     "model_devi_f_trust_lo": 0.5,
     "model_devi_f_trust_hi": 0.7,
     "model_devi_clean_traj": false,
     "model_devi_jobs": [
	{"sys_idx": [0],"temps": [350],"press": [1.0],"trj_freq": 10,"nsteps": 300,"ensemble": "nvt","_idx": "00"}
     ],
    "fp_style": "cp2k",
    "shuffle_poscar": false,
    "fp_task_max": 200,
    "fp_task_min": 0,
    "fp_pp_path": "/public/home/yaoshilong/bin/CP2K/cp2k-2024.2/data",
    "fp_pp_files": [],
    "external_input_path": "/public/home/yaoshilong/task2/2/2DPGEN/01run/template_point.inp"
}
```

参考资料：[基于CP2K的DP-GEN使用流程](https://zhuanlan.zhihu.com/p/9166088047)




# 5. Pt-H2O界面/cp2k

### 1. `param.json`文件



```json
{ 
    "type_map": [        
        "O", 
        "H",
        "Pt"
    ], 
    "mass_map": [ 
        15.999,
        1.0079,
        195.08
    ], 
    "_comment": " atoms in your systems ",
    "init_data_prefix": "/data/kmr/edl/pzc/hydroxide/ml_potential/pt-oh", 
    "init_data_sys": [
        "init/system-000","init/system-001"
    ], 
    "_comment": " path of training set ",
    "init_batch_size": [
        1,1
    ], 
    "sys_configs": [
        ["/data/kmr/edl/pzc/hydroxide/ml_potential/pt-oh/init/configs/POSCAR_0[0-9]"],
        ["/data/kmr/edl/pzc/hydroxide/ml_potential/pt-oh/init/configs/POSCAR_1[0-9]"]
    ], 
    "_comment": " path of initial structure for sampling ",
    "sys_batch_size": [
        1,1
    ], 


      "numb_models": 4, 
      "_comment": " number of NNP for model deviation ",
      "train_param": "input.json", 
      "_comment": " name of automatically generated input file for DPMD ",
      "default_training_param": {
          "model": {
          "descriptor": {
          "type": "se_a",
    "_comment": "could be bigger than the number of atoms of the very element",
          "sel": [68, 136, 64], 
          "rcut_smth": 0.50, 
          "rcut": 5.00, 
          "neuron": [25, 50, 100], 
          "resnet_dt": false, 
          "axis_neuron": 16,
          "seed": 1
          },
          "fitting_net": {
          "n_neuron": [240, 240, 240], 
          "resnet_dt": true, 
          "seed": 1
          }},
          "learning_rate": {
          "type": "exp",
          "start_lr": 0.005, 
          "decay_steps": 2000,
          "_comment": "last 20000 or 400000", 
          "decay_rate": 0.95
          },
          "loss": {
          "start_pref_e": 0.02, 
          "limit_pref_e": 1, 
          "start_pref_f": 1000, 
          "limit_pref_f": 1, 
          "start_pref_v": 0, 
          "limit_pref_v": 0
          },
          "training": {
          "systems": [ ], 
          "set_prefix": "set", 
          "stop_batch": 400000, 
          "batch_size": 1, 
          "seed": 1,
          "disp_file": "lcurve.out", 
          "disp_freq": 100, 
          "numb_test": 4, 
          "save_freq": 1000, 
          "save_ckpt": "model.ckpt", 
          "load_ckpt": "model.ckpt", 
          "disp_training": true, 
          "time_training": true, 
          "profiling": false, 
          "profiling_file": "timeline.json"
          }},
      "_comment": "modify according your systems!", 



    "model_devi_dt":            0.0005,
    "_comment": "model_devi_dt: Timesteps for MD. Consistent with DFTMD!",
    "model_devi_skip":          0,
    "_comment": "model_devi_skip: the first x frames of the recorded frames",
    "model_devi_f_trust_lo":    0.075,
    "model_devi_f_trust_hi":    0.10,
    "_comment": "modify according to the error distribution of system",
    "model_devi_e_trust_lo":    1e10,
    "model_devi_e_trust_hi":    1e10,
    "model_devi_clean_traj":    false,
    "model_devi_jobs": [
    {"temps": [300,400],"sys_idx": [0,1],"trj_freq": 10,"nsteps":  2000,"ensemble": "nvt","_idx": 0},
    {"temps": [300,400],"sys_idx": [0,1],"trj_freq": 10,"nsteps":  2000,"ensemble": "nvt","_idx": 1}
    ],
    "_comment": "sys_idx should correspond to sys_configs in the beginning",
    "_comment": "add the _idx step by step",
    "_comment": "modify nsteps and sys_idx based on model deviation accuracy",



    "fp_style":     "cp2k",
    "shuffle_poscar":   false,
    "fp_task_max":  200,
    "_comment":         "the maximum number of stcs to calc.",
    "fp_task_min":  5,
    "fp_pp_path":   ".",
    "fp_pp_files":  [],
    "_comment":"the maximum number of stcs to calc.",
     "_comment": "fp_params: modify according your systems!",
    "fp_params": {
        "FORCE_EVAL":{
            "DFT":{
                "BASIS_SET_FILE_NAME": "/data/kmr/BASIC_SET/BASIS_MOLOPT",
                "POTENTIAL_FILE_NAME": "/data/kmr/BASIC_SET/GTH_POTENTIALS",
                "MGRID":{
                    "CUTOFF": 400
                },
                "QS":{
                    "EPS_DEFAULT": 1.0E-13
                },
                "SCF":{
                    "SCF_GUESS": "ATOMIC",
                    "EPS_SCF": 1.0E-6,
                    "MAX_SCF": 500,
                    "ADDED_MOS": 500,
                    "CHOLESKY": "INVERSE",
                    "SMEAR":{"ON"
                        "METHOD": "FERMI_DIRAC",
                        "ELECTRONIC_TEMPERATURE": 300
                    },
                    "DIAGONALIZATION":{
                        "ALGORITHM": "STANDARD"
                    },
                    "MIXING":{
                               "METHOD": "BROYDEN_MIXING",
                               "ALPHA":   0.3,
                               "BETA":    1.5,
                               "NBROYDEN":  14
                    }
                },
                "XC":{
                        "XC_FUNCTIONAL":{"_": "PBE"},
                        "XC_GRID":{
                                "XC_SMOOTH_RHO": "NN50",
                                "XC_DERIV": "NN50_SMOOTH"
                        },
                        "vdW_POTENTIAL":{
                                "DISPERSION_FUNCTIONAL": "PAIR_POTENTIAL",
                                "PAIR_POTENTIAL":{
                                        "TYPE": "DFTD3",
                                        "PARAMETER_FILE_NAME": "/data/kmr/BASIC_SET/dftd3.dat",
                                        "REFERENCE_FUNCTIONAL": "PBE"
                                }
                        }
                }
           },
            "SUBSYS":{
                        "KIND":{
                                "_": ["O", "H","Pt"],
                                "POTENTIAL": ["GTH-PBE-q6", "GTH-PBE-q1","GTH-PBE-q10"],
                                "BASIS_SET": ["DZVP-MOLOPT-SR-GTH", "DZVP-MOLOPT-SR-GTH","DZVP-A5-Q10-323-MOL-T1-DERIVED_SET-1"]
                        }
            }
        }
    }
}
```


### 2. `machine.json`文件

```json
{
  "api_version": "1.0",
  "train": [
    {
      "command": "dp",
      "machine": {
        "batch_type": "Slurm",
        "context_type": "LocalContext",
        "local_root": "./",
        "remote_root": "/data/tom/dprun/train",
      },
      "resources": {
        "number_node": 1,
        "cpu_per_node": 1,
        "gpu_per_node": 1,
        "queue_name": "gpu3",
        "group_size": 1,
        "module_list": [
          "deepmd/2.0"
        ]
      }
    }
  ],
  "model_devi":[
    {
      "command": "lmp_mpi",
      "machine":{
        "batch_type": "Slurm",
        "context_type": "SSHContext",
        "local_root": "./",
        "remote_root": "/data/jerry/dprun/md",
        "remote_profile": {
          "hostname": "198.76.54.32",
          "username": "jerry",
          "port": 6666
        }
      },
      "resources": {
        "number_node": 1,
        "cpu_per_node": 1,
        "gpu_per_node": 1,
        "queue_name": "gpu2",
        "group_size": 5,
        "kwargs": {
          "custom_gpu_line": [
            "#SBATCH --gres=gpu:1g.10gb:1"
          ]
        },
        "strategy": {"if_cuda_multi_devices": false},
        "para_deg": 2,
        "module_list": [
          "deepmd/2.1"
        ],
        "source_list": []
      }
    }
  ],
  "fp":[
    {
      "command": "mpiexec.hydra -genvall cp2k.popt input.inp",
      "machine":{
        "batch_type": "Slurm",
        "context_type": "SSHContext",
        "local_root": "./",
        "remote_root": "/data/jerry/dprun/fp",
        "remote_profile": {
          "hostname": "198.76.54.32",
          "username": "jerry",
          "port": 6666
        }
      },
      "resources": {
        "number_node": 2,
        "cpu_per_node": 32,
        "gpu_per_node": 0,
        "queue_name": "c53-medium",
        "group_size": 10,
        "module_list": [
          "intel/17.5.239",
          "mpi/intel/2017.5.239",
          "gcc/5.5.0"
          "cp2k/7.1"
        ]
      }
    }
  ]
}
```


参考资料：[DP-GEN使用入门](https://wiki.cheng-group.net/en/wiki/software_usage/DP-GEN/)





# 6. 甲烷/cp2k/github官方

### 1.1 `param-ch4.json`文件

```json
{
    "type_map": [
        "H",
        "C"
    ],
    "mass_map": [
        1,
        12
    ],
    "init_data_prefix": "/data/ybzhuang/methane-dpgen/dpgen-tutorial-2020-08-23/dpgen-tutorial-mathane/data",
    "init_data_sys": [
        "deepmd"
    ],
    "init_batch_size": [
        8
    ],
    "sys_configs": [
        [
            "/data/ybzhuang/methane-dpgen/dpgen-tutorial-2020-08-23/dpgen-tutorial-mathane/data/CH4.POSCAR.01x01x01/01.scale_pert/sys-0004-0001/scale-1.000/00000*/POSCAR"
        ],
        [
            "/data/ybzhuang/methane-dpgen/dpgen-tutorial-2020-08-23/dpgen-tutorial-mathane/data/CH4.POSCAR.01x01x01/01.scale_pert/sys-0004-0001/scale-1.000/00000*/POSCAR"
        ]
    ],
    "sys_batch_size": [
        8,
        8,
        8,
        8
    ],
    "_comment1": " that's all ",
    "numb_models": 4,
    "default_training_param": {
        "model": {
            "descriptor": {
                "type": "se_a",
                "sel": [
                    16,
                    4
                ],
                "rcut_smth": 0.5,
                "rcut": 5.0,
                "_comment2": "modify according your system",
                "neuron": [
                    10,
                    20,
                    40
                ],
                "resnet_dt": false,
                "axis_neuron": 12,
                "seed": 1
            },
            "fitting_net": {
                "neuron": [
                    120,
                    120,
                    120
                ],
                "resnet_dt": true,
                "seed": 1
            }
        },
        "learning_rate": {
            "type": "exp",
            "start_lr": 0.001,
            "decay_steps": 100,
            "_comment3": "nope",
            "stop_lr": 0.0003584859224085419
        },
        "loss": {
            "start_pref_e": 0.02,
            "limit_pref_e": 2,
            "start_pref_f": 1000,
            "limit_pref_f": 1,
            "start_pref_v": 0.0,
            "limit_pref_v": 0.0
        },
        "training": {
            "stop_batch": 2000,
            "seed": 1,
            "disp_file": "lcurve.out",
            "disp_freq": 1000,
            "save_freq": 1000,
            "save_ckpt": "model.ckpt",
            "disp_training": true,
            "time_training": true,
            "profiling": false,
            "profiling_file": "timeline.json",
            "training_data": {
                "systems": [],
                "batch_size": 1
            }
        }
    },
    "model_devi_dt": 0.002,
    "model_devi_skip": 0,
    "model_devi_f_trust_lo": 0.05,
    "model_devi_f_trust_hi": 0.15,
    "model_devi_clean_traj": true,
    "model_devi_jobs": [
        {
            "sys_idx": [
                0
            ],
            "temps": [
                100
            ],
            "press": [
                1
            ],
            "trj_freq": 10,
            "nsteps": 300,
            "ensemble": "nvt",
            "_idx": "00"
        },
        {
            "sys_idx": [
                1
            ],
            "temps": [
                100
            ],
            "press": [
                1
            ],
            "trj_freq": 10,
            "nsteps": 3000,
            "ensemble": "nvt",
            "_idx": "01"
        }
    ],
    "fp_style": "cp2k",
    "shuffle_poscar": false,
    "fp_task_max": 20,
    "fp_task_min": 5,
    "external_input_path": "/data/ybzhuang/methane-dpgen/dpgen-tutorial-2020-08-23/dpgen-tutorial-mathane/cp2k_dpgen/template.inp"
}
```

### 1.2 `template.inp` 文件

上述 `param.json` 文件会调用该 `template.inp` 文件文件，基于cp2k进行DFT标注

```sh
#Basis setting
@SET SCALE_FACTOR 1.000
@SET NREPA 1
@SET NREPB 1
@SET NREPC 1
@SET CELL_A 10
@SET CELL_B 10
@SET CELL_C 10
@SET ANGLE_A 90.0
@SET ANGLE_B 90.0
@SET ANGLE_C 90.0
@SET COORDFILE coord.xyz
@SET CUTOFF 400
@SET JOBNAME DPGEN


&FORCE_EVAL
  METHOD QS
  STRESS_TENSOR ANALYTICAL
  &PRINT
    &FORCES ON
    &END FORCES
    &STRESS_TENSOR ON
    &END STRESS_TENSOR
  &END PRINT

  &DFT
    BASIS_SET_FILE_NAME BASIS_MOLOPT
    POTENTIAL_FILE_NAME GTH_POTENTIALS
      &MGRID
      	CUTOFF ${CUTOFF}
        REL_CUTOFF 60
      &END MGRID
      &QS
      	EPS_DEFAULT 1.0E-13
      &END QS
      &SCF
        SCF_GUESS RESTART
      	EPS_SCF 3.0E-7
      	MAX_SCF 50
      	&OUTER_SCF
          EPS_SCF 3.0E-7
          MAX_SCF 15
      	&END OUTER_SCF
     	&OT
          MINIMIZER  DIIS
          PRECONDITIONER FULL_SINGLE_INVERSE
        &END OT
      &END SCF
      &XC
########## This part is PBE ##########
    	&XC_FUNCTIONAL PBE
    	&END XC_FUNCTIONAL
########## This part is PBE ##########
      &END XC
########## This part controls the print information ##########
  &END DFT
  &SUBSYS
    &CELL
      ABC [angstrom]   ${CELL_A}*${SCALE_FACTOR} ${CELL_B}*${SCALE_FACTOR} ${CELL_C}*${SCALE_FACTOR}
      ALPHA_BETA_GAMMA ${ANGLE_A} ${ANGLE_B} ${ANGLE_C}
      MULTIPLE_UNIT_CELL ${NREPA} ${NREPB} ${NREPC}
    &END CELL
    &TOPOLOGY
      MULTIPLE_UNIT_CELL ${NREPA} ${NREPB} ${NREPC}
    &END TOPOLOGY
    &COORD
      @include ${COORDFILE}
    &END COORD
    &KIND H
      BASIS_SET DZVP-MOLOPT-SR-GTH
      POTENTIAL GTH-PBE-q1
    &END KIND
    &KIND C
      BASIS_SET DZVP-MOLOPT-SR-GTH
      POTENTIAL GTH-PBE-q4
    &END KIND
  &END SUBSYS
&END FORCE_EVAL

&GLOBAL
  PROJECT ${JOBNAME}
&END GLOBAL
```


### 2. `param_CH4_deepmd-kit-2.0.1.json`

```json
{
    "type_map": [
        "H",
        "C"
    ],
    "mass_map": [
        1,
        12
    ],
    "init_data_prefix": "./data",
    "init_data_sys": [
        "deepmd"
    ],
    "sys_configs": [
        [
            "./data/CH4.POSCAR.01x01x01/01.scale_pert/sys-0004-0001/scale-1.000/00000*/POSCAR"
        ],
        [
            "./data/CH4.POSCAR.01x01x01/01.scale_pert/sys-0004-0001/scale-1.000/00001*/POSCAR"
        ]
    ],
    "_comment1": " that's all ",
    "numb_models": 4,
    "default_training_param": {
        "model": {
            "type_map": [
                "H",
                "C"
            ],
            "descriptor": {
                "type": "se_a",
                "sel": [
                    16,
                    4
                ],
                "rcut_smth": 0.5,
                "rcut": 5.0,
                "neuron": [
                    25,
                    50,
                    100
                ],
                "resnet_dt": true,
                "axis_neuron": 12,
                "seed": 1
            },
            "fitting_net": {
                "neuron": [
                    120,
                    120,
                    120
                ],
                "resnet_dt": false,
                "seed": 1
            }
        },
        "learning_rate": {
            "type": "exp",
            "start_lr": 0.001,
            "decay_steps": 200
        },
        "loss": {
            "start_pref_e": 0.02,
            "limit_pref_e": 1,
            "start_pref_f": 1000,
            "limit_pref_f": 1,
            "start_pref_v": 0.0,
            "limit_pref_v": 0.0
        },
        "training": {
            "stop_batch": 40000,
            "_batch_size": 1,
            "disp_file": "lcurve.out",
            "disp_freq": 1000,
            "save_freq": 1000,
            "save_ckpt": "model.ckpt",
            "disp_training": true,
            "time_training": true,
            "profiling": false,
            "profiling_file": "timeline.json",
            "_comment2": "that's all"
        }
    },
    "model_devi_dt": 0.002,
    "model_devi_skip": 0,
    "model_devi_f_trust_lo": 0.02,
    "model_devi_f_trust_hi": 0.15,
    "model_devi_clean_traj": true,
    "model_devi_jobs": [
        {
            "sys_idx": [
                0
            ],
            "temps": [
                100
            ],
            "press": [
                1
            ],
            "trj_freq": 10,
            "nsteps": 2000,
            "ensemble": "nvt",
            "_idx": "00"
        },
        {
            "sys_idx": [
                1
            ],
            "temps": [
                100
            ],
            "press": [
                1
            ],
            "trj_freq": 10,
            "nsteps": 5000,
            "ensemble": "nvt",
            "_idx": "01"
        }
    ],
    "ratio_failed": 0.2,
    "fp_style": "cp2k",
    "shuffle_poscar": false,
    "fp_task_max": 30,
    "fp_task_min": 1,
    "user_fp_params": {
        "FORCE_EVAL": {
            "DFT": {
                "BASIS_SET_FILE_NAME": "BASIS_MOLOPT",
                "POTENTIAL_FILE_NAME": "GTH_POTENTIALS"
            },
            "SUBSYS": {
                "KIND": {
                    "_": [
                        "C",
                        "H"
                    ],
                    "POTENTIAL": [
                        "GTH-PBE-q4",
                        "GTH-PBE-q1"
                    ],
                    "BASIS_SET": [
                        "DZVP-MOLOPT-GTH",
                        "DZVP-MOLOPT-GTH"
                    ]
                }
            }
        }
    }
}
```


参考资料：https://github.com/deepmodeling/dpgen/tree/master/examples/run/dp2.x-lammps-cp2k






