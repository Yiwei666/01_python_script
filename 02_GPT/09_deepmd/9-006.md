# dp-gen输入文件和关键词

# 1. 概述

- `param.json` 文件作为 DP-GEN run 流程的核心配置文件，详细定义了用于指导系统和数据处理、模型训练、结构探索（模型偏差）以及第一性原理计算（标注）这四个关键步骤的各项参数和设置。



# 2. dp-gen 输入文件

## 1. 官方上手案例


1. 文件下载地址

- https://dp-public.oss-cn-beijing.aliyuncs.com/community/dpgen_example.tar.xz


2. 项目文件夹

```
├── init
    ├── CH4.POSCAR
    ├── CH4.POSCAR.01x01x01
        ├── 00.place_ele
        ├── 01.scale_pert
        ├── 02.md
        └── param.json
    ├── INCAR_methane.md
    ├── INCAR_methane.rlx
    └── param.json
└── run
    ├── INCAR_methane
    ├── POTCAR_C
    ├── POTCAR_H
    ├── machine.json
    └── param.json
```

- 文件夹 `init` 包含由 AIMD 模拟生成的初始数据。
- 文件夹 `run` 包含运行过程的输入文件。
  - `param.json` 是当前任务中 DP-GEN 的设置文件。
  - `machine.json` 是一个任务分配器，用于设置机器环境和资源需求。
  - `INCAR*` 和 `POTCAR*` 是 VASP 软件包的输入文件，所有第一性原理计算共享与 `param.json` 中设置的相同参数。



### 1. `param.json`文件

```json
{
     "type_map": ["H","C"],
     "mass_map": [1,12],
     "init_data_prefix": "../",
     "init_data_sys": ["init/CH4.POSCAR.01x01x01/02.md/sys-0004-0001/deepmd"],
     "sys_configs_prefix": "../",
     "sys_configs": [
         ["init/CH4.POSCAR.01x01x01/01.scale_pert/sys-0004-0001/scale-1.000/00000*/POSCAR"],
         ["init/CH4.POSCAR.01x01x01/01.scale_pert/sys-0004-0001/scale-1.000/00001*/POSCAR"]
     ],
     "_comment": " that's all ",
     "numb_models": 4,
     "default_training_param": {
         "model": {
             "type_map": ["H","C"],
             "descriptor": {
                 "type": "se_a",
                 "sel": [16,4],
                 "rcut_smth": 0.5,
                 "rcut": 5.0,
                 "neuron": [120,120,120],
                 "resnet_dt": true,
                 "axis_neuron": 12,
                 "seed": 1
             },
             "fitting_net": {
                 "neuron": [25,50,100],
                 "resnet_dt": false,
                 "seed": 1
             }
         },
         "learning_rate": {
             "type": "exp",
             "start_lr": 0.001,
             "decay_steps": 5000
         },
         "loss": {
             "start_pref_e": 0.02,
             "limit_pref_e": 2,
             "start_pref_f": 1000,
             "limit_pref_f": 1,
             "start_pref_v": 0.0,
             "limit_pref_v": 0.0
         },
         "training": {
             "stop_batch": 2000,
             "disp_file": "lcurve.out",
             "disp_freq": 1000,
             "numb_test": 4,
             "save_freq": 1000,
             "save_ckpt": "model.ckpt",
             "disp_training": true,
             "time_training": true,
             "profiling": false,
             "profiling_file": "timeline.json",
             "_comment": "that's all"
         }
     },
     "model_devi_dt": 0.002,
     "model_devi_skip": 0,
     "model_devi_f_trust_lo": 0.05,
     "model_devi_f_trust_hi": 0.15,
     "model_devi_e_trust_lo": 10000000000.0,
     "model_devi_e_trust_hi": 10000000000.0,
     "model_devi_clean_traj": true,
     "model_devi_jobs": [
         {"sys_idx": [0],"temps": [100],"press": [1.0],"trj_freq": 10,"nsteps": 300,"ensemble": "nvt","_idx": "00"},
         {"sys_idx": [1],"temps": [100],"press": [1.0],"trj_freq": 10,"nsteps": 3000,"ensemble": "nvt","_idx": "01"}
     ],
     "fp_style": "vasp",
     "shuffle_poscar": false,
     "fp_task_max": 20,
     "fp_task_min": 5,
     "fp_pp_path": "./",
     "fp_pp_files": ["POTCAR_H","POTCAR_C"],
     "fp_incar": "./INCAR_methane"
}
```

### 2. `machine.json`文件










## 1. H2O体系

- H2O体系，基于CP2K的DFT标注

### 1. `param.json`文件

```json
{
     "type_map": ["H"," O"],    # 初始数据集中所包含的元素，顺序与npy数据中的一样即可
     "mass_map": [1,16],        # 元素的相对原子质量
     "init_data_prefix": "../", # 初始数据集路径中的前缀
     "init_data_sys": ["00data/training_data/H2O1"  # 初始数据集路径除前缀后的部分。所以我的初始数据集路径为："../00data/training_data/H2O1"
],
     "sys_configs_prefix": "../",       # 用于动力学模拟的结构种子路径中的前缀
     "sys_configs": [
	["00data/initial_structure/1/*"]    # 用于动力学模拟的结构种子路径除前缀后的部分
     ],
     "_comment": " that's all ",
     "numb_models": 4,                  # 训练的DP势数量
     "default_training_param": {
         "model": {
             "type_map": ["H","O"],     # 体系元素种类
             "descriptor": {
                 "type": "se_e2_a",     
                 "sel": [200,100],      # 截断半径内可能包含的相应元素的原子数最大值
                 "rcut_smth": 0.5,      # 开始平滑处理的距离
                 "rcut":6.0,            # 截断半径
                 "neuron": [20,40,80],
                 "resnet_dt": false,
                 "axis_neuron": 12,
                 "seed": 1
             },
             "fitting_net": {
                 "neuron": [150,150,150],
                 "resnet_dt": true,
                 "seed": 1
             }
         },
         "learning_rate": {
             "type": "exp",
             "start_lr": 0.001,
	     "stop_lr":	3.51e-8,
             "decay_steps": 1000
         },
         "loss": {
             "start_pref_e": 0.02,
             "limit_pref_e": 2,
             "start_pref_f": 1000,
             "limit_pref_f": 1,
             "start_pref_v": 0.0,
             "limit_pref_v": 0.0
         },
         "training": {
             "stop_batch": 200000,
             "disp_file": "lcurve.out",
             "disp_freq": 1000,
             "numb_test": 4,
             "save_freq": 1000,
             "save_ckpt": "model.ckpt",
             "disp_training": true,
             "time_training": true,
             "profiling": false,
             "profiling_file": "timeline.json",
             "_comment": "that's all"
         }
     },
     "model_devi_dt": 0.0005,
     "model_devi_skip": 0,
     "model_devi_f_trust_lo": 0.5,
     "model_devi_f_trust_hi": 0.7,
     "model_devi_clean_traj": false,
     "model_devi_jobs": [
	{"sys_idx": [0],"temps": [350],"press": [1.0],"trj_freq": 10,"nsteps": 300,"ensemble": "nvt","_idx": "00"}
     ],
    "fp_style": "cp2k",
    "shuffle_poscar": false,
    "fp_task_max": 200,
    "fp_task_min": 0,
    "fp_pp_path": "/public/home/yaoshilong/bin/CP2K/cp2k-2024.2/data",
    "fp_pp_files": [],
    "external_input_path": "/public/home/yaoshilong/task2/2/2DPGEN/01run/template_point.inp"
}
```

参考资料：[基于CP2K的DP-GEN使用流程](https://zhuanlan.zhihu.com/p/9166088047)








